@using Eproject.Areas.Identity.Data;
@using Microsoft.AspNetCore.Identity
@using System.Linq
@inject UserManager<EprojectUser> UserManager
@{
    ViewData["Title"] = "User Management";
    Layout = "_Layout";
}
<h1>@ViewData["Title"]</h1>
<head>
    <!-- 1.5ml -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Roll/Employee Number</th>
            <th>Section</th>
            <th>Specification</th>
            <th>Class</th>
            <th>Roles</th>
            <th>Approved</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            <tr>

                <td>@user.UserName</td>
                <td>@user.Email</td>
                <td>@user.Code</td>
                <td>@user.Section</td>
                <td>@user.Specification</td>
                <td>@user.Class</td>
                <td>@string.Join(", ", user.Roles)</td>
                <td>
                    <input type="checkbox" @(user.IsApproved ? "checked" : "") data-user-id="@user.UserId" class="approveCheckbox">
                </td>
                <td>
                    <a class="btn btn-primary" asp-controller="Admin" asp-action="Manage" asp-route-userId="@user.UserId">Manage User</a>
                </td>
            </tr>
        }
    </tbody>
</table>
<script>
    $(document).ready(function () {
        $(".approveCheckbox").on("change", function () {
            var isChecked = $(this).prop("checked");
            var userId = $(this).data("user-id");
            updateUserApproval(userId, isChecked);
        });

        function updateUserApproval(userId, isChecked) {
            $.ajax({
                url: "/Admin/UpdateApproval",
                method: "POST",
                contentType: "application/json;charset=UTF-8",
                data: JSON.stringify({ userId: userId, isApproved: isChecked }),
                success: function () {
                    console.log("success")
                    // Update successful, if needed
                },
                error: function () {
                    console.log("error")
                    // Handle error, if needed
                }
            });
        }
    });
</script>
